#!/bin/bash

# Menggunakan tput untuk menambahkan warna
GREEN=$(tput setaf 2)    # Hijau
RED=$(tput setaf 1)      # Merah
YELLOW=$(tput setaf 3)   # Kuning
BLUE=$(tput setaf 4)     # Biru
NC=$(tput sgr0)          # Tidak ada warna (reset)

# Fungsi untuk mencetak garis pemisah
print_line() {
    echo -e "${BLUE}========================================${NC}"
}

# Fungsi untuk memeriksa status container Docker Marzban
check_container_status() {
    local container_name="marzban-marzban-1"
    local status=$(docker inspect -f '{{.State.Running}}' "$container_name" 2>/dev/null)
    echo -e "${BLUE}Docker Container:${NC}"
    if [ "$status" == "true" ]; then
        echo -e "  ${GREEN}✔ Marzban is running.${NC}"
    else
        echo -e "  ${RED}✘ Marzban is not running.${NC}"
    fi
}

# Fungsi untuk memeriksa status Fix Instances service
check_fix_instances_status() {
    local status=$(systemctl is-active fix.service)
    echo -e "${BLUE}Fix Instances Service:${NC}"
    if [ "$status" == "active" ]; then
        echo -e "  ${GREEN}✔ Fix Instances is active.${NC}"
    else
        echo -e "  ${RED}✘ Fix Instances is not active.${NC}"
    fi
}

# Fungsi untuk mengecek penggunaan data tahunan dengan vnstat
check_vnstat_usage() {
    echo -e "${BLUE}Annual Data Usage (vnStat):${NC}"
    if ! command -v vnstat &> /dev/null; then
        echo -e "  ${RED}✘ vnStat is not installed. Please install vnstat.${NC}"
    else
        # Menangani hasil vnstat dan menampilkan data tanpa tanda centang
        vnstat --oneline | awk -F';' -v GREEN="$GREEN" -v NC="$NC" '{ 
            iface=$1; 
            usage=$13; 
            unit=$14; 
            printf "  %sInterface: %s\n  %sTotal Data: %s %s\n", GREEN, iface, GREEN, usage, unit;
        }'
    fi
}

# Eksekusi fungsi
print_line
check_container_status
check_fix_instances_status
check_vnstat_usage
print_line
